<!DOCTYPE html>
<html>
  <head>
    <script src="coffee-script.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.6/d3.min.js"></script>
    <script src="../audiovisual.js"></script>
    <script src="gn_hrtf_fft_100x180.js"></script>
    <script src="gn_hrtfs.js"></script>
    <script src="boley_hrtfs.js"></script>
    <link rel="stylesheet" href="../audiovisual.css" />
    <link href="http://fonts.googleapis.com/css?family=Raleway:400,100,300,500,700" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <br />
    <br />
    <div id="plot"></div>
    <script type="text/coffeescript">




      polarPlot = new AV.PolarPlotHeatmap '#plot',
        options:
          directionalLine: true
          directionalRotation: false
        plotOptions:
          circleLabelOffsetY: -5
          padding: 30
          zeroOffset: 90
          axisLabelOffsetX: 20
          axisLabelRotationOffset: 90
          outerPaddingForAxisLabels: 20

      polarPlot.draw
        ringLabels: [
          {label: '', value: 1}
          {label: '', value: 2}
          {label: '', value: 3}
          {label: '', value: 4}
          {label: '', value: 5}
          {label: '', value: 6}
          {label: '', value: 7}
          {label: '', value: 8}
          {label: '', value: 9}
          {label: '', value: 10}
          {label: '', value: 11}
          {label: '', value: 12}
          {label: '', value: 13}
          {label: '', value: 14}
          {label: '', value: 15}
          {label: '', value: 16}
          {label: '', value: 17}
          {label: '', value: 18}
          {label: '', value: 19}
          {label: '', value: 20}
          {label: '', value: 21}
          {label: '', value: 22}
          {label: '', value: 23}
          {label: '', value: 24}
          {label: '', value: 25}
          {label: '', value: 26}
          {label: '', value: 27}
          {label: '', value: 28}
          {label: '', value: 29}
          {label: '', value: 30}
          {label: '', value: 31}
          {label: '', value: 32}
          {label: '', value: 33}
          {label: '', value: 34}
          {label: '', value: 35}
          {label: '', value: 36}
          {label: '', value: 37}
          {label: '', value: 38}
          {label: '', value: 39}
          {label: '', value: 40}
          {label: '', value: 41}
          {label: '', value: 42}
          {label: '', value: 43}
          {label: '', value: 44}
          {label: '', value: 45}
          {label: '', value: 46}
          {label: '', value: 47}
          {label: '', value: 48}
          {label: '', value: 49}
          {label: '', value: 50}
          {label: '', value: 51}
          {label: '', value: 52}
          {label: '', value: 53}
          {label: '', value: 54}
          {label: '', value: 55}
          {label: '', value: 56}
          {label: '', value: 57}
          {label: '', value: 58}
          {label: '', value: 59}
          {label: '', value: 60}
          {label: '', value: 61}
          {label: '', value: 62}
          {label: '', value: 63}
          {label: '', value: 64}
          {label: '', value: 65}
          {label: '', value: 66}
          {label: '', value: 67}
          {label: '', value: 68}
          {label: '', value: 69}
          {label: '', value: 70}
          {label: '', value: 71}
          {label: '', value: 72}
          {label: '', value: 73}
          {label: '', value: 74}
          {label: '', value: 75}
          {label: '', value: 76}
          {label: '', value: 77}
          {label: '', value: 78}
          {label: '', value: 79}
          {label: '', value: 80}
          {label: '', value: 81}
          {label: '', value: 82}
          {label: '', value: 83}
          {label: '', value: 84}
          {label: '', value: 85}
          {label: '', value: 86}
          {label: '', value: 87}
          {label: '', value: 88}
          {label: '', value: 89}
          {label: '', value: 90}
          {label: '', value: 91}
          {label: '', value: 92}
          {label: '', value: 93}
          {label: '', value: 94}
          {label: '', value: 95}
          {label: '', value: 96}
          {label: '', value: 97}
          {label: '', value: 98}
          {label: '', value: 99}
          {label: '', value: 100}
        ]
        axisLabels: [
          {label: '0', axis: 0}
          {label: '', axis: 20}
          {label: '45', axis: 45}
          {label: '', axis: 67}
          {label: '90', axis: 90}
          {label: '', axis: 113}
          {label: '135', axis: 135}
          {label: '', axis: 157}
          {label: '180', axis: 180}
          {label: '', axis: 203}
          {label: '225', axis: 225}
          {label: '', axis: 247}
          {label: '270', axis: 270}
          {label: '', axis: 293}
          {label: '315', axis: 315}
          {label: '', axis: 337}
        ]

      heatmap = polarPlot.heatmap data: hrtfSpectrum

      heatmap.render()

      hrtf = new AV.HRTF(data.HRTFs)

      request = new XMLHttpRequest()
      request.open('GET', 'scaled_english_female.wav', true)
      request.responseType = 'arraybuffer'
      request.onload = ->
        hrtf.loadAudioBuffer request.response, ->
          hrtf.connect()
          hrtf.play()
          polarPlot.spin()

      request.send()


      polarPlot.on 'degreeChange', (data) ->
        hrtf.angle(data.angle);

    </script>
  </body>
</html>
